<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Christmas Tree (Version 2)</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #000;
  overflow: hidden;
  font-family: sans-serif;
}

/* MAIN WRAPPER */
#app {
  position: absolute;
  inset: 0;
  width: 100vw;
  height: 100dvh; /* CHU·∫®N 100% CHI·ªÄU CAO iPAD */
  max-width: 1620px;
  max-height: 2160px;
  margin: 0 auto;
  overflow: hidden;
}

/* BACKGROUND VIDEO */
#bgVideo {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover; /* ho·∫∑c contain if c·∫ßn */
}

/* HOTSPOT */
.hotspot {
  transform: translate(-50%, -50%);
  position: absolute;
  width: 84px;
  height: 84px;
  cursor: pointer;
  border-radius: 50%;
}

@keyframes float {
  0% { transform: translate(-50%, -50%) translateY(0) rotate(-2deg); }
  50% { transform: translate(-50%, -50%) translateY(-8px) rotate(2deg); }
  100% { transform: translate(-50%, -50%) translateY(0) rotate(-2deg); }
}

/* POPUP OVERLAY */
#popupOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 300;
}

#popupBox {
  position: relative;
  width: 100vw;
  height: 100vh;
  max-width: 1620px;
  max-height: 2160px;
  display: flex;
  justify-content: center;
  align-items: center;
}
/* CLOSE BUTTON */
#closeBtn {
  position: absolute;
  top: 32px;
  right: 32px;

  width: 56px;
  height: 56px;
  border-radius: 50%;

  /* üéÑ V√ÄNG ƒê·ªíNG ƒê·∫¨M ‚Äì KH√îNG CH√ìI */
  background: radial-gradient(
    circle at top left,
    #d1a24b 0%,
    #b8832f 65%,
    #a87325 100%
  );

  /* üå≤ VI·ªÄN XANH TH√îNG ƒê·∫¨M */
  border: 3px solid #1e5f46;

  /* ‚úñÔ∏è D·∫§U X ‚Äì N√ÇU ƒê·∫¨M */
  color: #2f2414;

  font-size: 26px;
  font-weight: 700;
  line-height: 1;

  display: flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
  z-index: 400;

  /* ‚ú® ƒê·ªî B√ìNG NH·∫∏ ‚Äì KH√îNG GLOW */
  box-shadow:
    0 3px 6px rgba(0,0,0,0.35),
    inset 0 1px 2px rgba(255,255,255,0.25);

  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#closeBtn:hover {
  transform: scale(1.06);
  box-shadow:
    0 5px 10px rgba(0,0,0,0.45),
    inset 0 1px 3px rgba(255,255,255,0.35);
}




/* POPUP VIDEO */
#popupVideo {
  width: auto;
  height: 100%;
  object-fit: contain;
  z-index: 10;
}
  
/* TEXT */
.popupText {
  font-family: 
    "Myriad Pro",
    "MyriadPro",
    "Segoe UI",
    "Helvetica Neue",
    Arial,
    sans-serif;
  letter-spacing: -0.02em;
  position: absolute;
  inset: 0;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  z-index: 50;
  pointer-events: none;

  /* responsive font size */
  font-size: clamp(28px, 4vw, 46px);
  line-height: 1.15;
  font-weight: 700;
  color: #111;

  opacity: 0;
  transform: translateY(20px) scale(0.98);
  -webkit-text-stroke: 1px rgba(255,255,255,0.6);
}
.popupText .giftName {
  font-weight: 800;
  letter-spacing: -0.01em;
}

.popupText.show {
  animation: popupTextReveal 0.6s ease-out forwards;
}

@keyframes popupTextReveal {
  0% {
    opacity: 0;
    transform: translateY(20px) scale(0.98);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* SNOW */
.snowflake {
  position: absolute;
  top: -10px;
  background: white;
  border-radius: 50%;
  opacity: 0.8;
  filter: drop-shadow(0 0 6px rgba(255,255,255,0.6));
  animation: fall linear infinite;
}

@keyframes fall {
  0% { transform: translateY(-20px); opacity: 0.3; }
  50% { opacity: 1; }
  100% { transform: translateY(110vh); opacity: 0.3; }
}

/* FIREWORK PARTICLE */
.particle {
  position: absolute;
  border-radius: 50%;
  opacity: 1;
  width: 12px;
  height: 12px;
  filter: drop-shadow(0 0 10px rgba(255,255,255,0.9));
  transform: translate(0, 0) scale(0.4);
  animation: explode 1.2s ease-out forwards;
  will-change: transform, opacity;
}

@keyframes explode {
  0% {
    transform: translate(0, 0) scale(0.4);
    opacity: 1;
  }
  70% {
    opacity: 1;
  }
  100% {
    transform: translate(var(--tx, 0px), var(--ty, 0px)) scale(1.2);
    opacity: 0;
  }
}
/* =========================================================
   ==============    MOBILE ‚â§ 768px    =====================
========================================================= */
@media (max-width: 767px) {
  #bgVideo,
  #popupVideo {
    width: 100%;
    height: 100%;
    object-fit: contain !important; /* Gi·ªØ nguy√™n t·ªâ l·ªá, kh√¥ng crop 2 b√™n */
    background: #000; /* gi√∫p top/bottom c√≥ m√†u ƒëen */
  }

  #app {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
  }

  #popupBox {
    width: 100vw;
    height: 100vh;
    background: #000;
  }
  .hotspot {
    width: 80px;
    height: 80px;
  }
  .popupText {
    font-size: clamp(20px, 3vw, 35px);
  }
  /* #closeBtn {
    position: absolute;
    width: 50px;
    height: 50px;
    top: 180px;
    right: 20px;
    border-width: 3px;
    font-size: 30px;
  } */
  #closeBtn {
    width: 44px;
    height: 44px;
    font-size: 22px;
    top: 20px;
    right: 20px;
    border-width: 2px;
  }
  #text7 {
  justify-content: flex-start;   /* ƒë·∫©y n·ªôi dung l√™n tr√™n */
  align-items: flex-start;       /* canh tr√°i */

  text-align: left;

  padding-left: 25%;
  padding-top: 54%;
  font-size: 26px !important;
}
}
/* =========================================================
   ==============   768px ‚â§ TABLET ‚â§ 1024px    =====================
========================================================= */
@media (min-width: 767px) and (max-width: 1024px) {
  .hotspot {
    width: 130px;
    height: 130px;
  }

  #closeBtn {
    top: 5%;
    width: 50px;
    height: 50px;
    font-size: 30px;
  }

  .popupText {
    /* font-size: clamp(30px, 4vw, 454545); */
    font-size: 33px !important; 
    line-height: 1.2;
  }
  .giftImage {
    top: 80%;        
    width: 30%;       
  }
  #text7 {
    position: absolute !important;

    top: 40%;      /* C·ªê ƒê·ªäNH */
    left: 25%;     /* C·ªê ƒê·ªäNH */
    width: 46%;    /* C·ªê ƒê·ªäNH */

    display: block !important;

    text-align: left;
    align-items: flex-start;
    justify-content: flex-start;

    /* font-size: 24px !important; */
    /* line-height: 1.35; */

    padding: 0 !important;
    margin: 0 !important;
  }
}
/* =========================================================
   LAPTOP 1025px ‚Üí 1366px
========================================================= */
@media (min-width: 1025px) and (max-width: 1366px) {
  .hotspot {
    width: 130px;
    height: 130px;
  }

  #closeBtn {
    position: absolute;
    width: 76px;
    height: 76px;
    top: 30px;
    right: 475px;
    border-width: 3px;
    font-size: 30px;
  }
  
  .popupText {
    font-size: clamp(30px, 3vw, 35px);
  }
  #text7 {
  justify-content: flex-start;   /* ƒë·∫©y n·ªôi dung l√™n tr√™n */
  align-items: flex-start;       /* canh tr√°i */

  text-align: left;

  padding-left: 25%;
  padding-top: 54%;
  font-size: 26px !important;
}
}
/* =========================================================
   PC 1367px ‚Üí 1919px
========================================================= */
@media (min-width: 1367px) and (max-width: 1919px) {
  .hotspot {
    width: 130px;
    height: 130px;
    filter: blur(12px);
  }

  #closeBtn {
    position: absolute;
    width: 76px;
    height: 76px;
    top: 30px;
    right: 475px;
    border-width: 3px;
    font-size: 30px;
  }

  .popupText {
    font-size: clamp(30px, 2.5vw, 40px);
    line-height: 1.1;
  }
  #text7 {
  justify-content: flex-start;   /* ƒë·∫©y n·ªôi dung l√™n tr√™n */
  align-items: flex-start;       /* canh tr√°i */

  text-align: left;

  padding-left: 25%;
  padding-top: 54%;
  font-size: 26px !important;
}
}
/* =========================================================
   DESKTOP ‚â• 1920px
========================================================= */
@media (min-width: 1920px) {
  #app {
    max-width: 1800px;
    max-height: 2400px;
  }

  .hotspot {
    width: 130px;
    height: 130px;
  }

  #closeBtn {
    position: absolute;
    width: 76px;
    height: 76px;
    top: 30px;
    right: 475px;
    border-width: 3px;
    font-size: 30px;
  }

  .popupText {
    font-size: clamp(30px, 2vw, 50px);
  }
  #text7 {
  justify-content: flex-start;   /* ƒë·∫©y n·ªôi dung l√™n tr√™n */
  align-items: flex-start;       /* canh tr√°i */

  text-align: left;

  padding-left: 25%;
  padding-top: 54%;
  font-size: 26px !important;
}
}
/* =========================================================
   VIDEO FIX CHUNG ‚Äî √ÅP D·ª§NG CHO T·∫§T C·∫¢ ‚â• 1024px
   Video lu√¥n v√†o gi·ªØa, kh√¥ng crop, th·ª´a hai b√™n tr√°i/ph·∫£i OK
========================================================= */
@media (min-width: 1025px) {
  #bgVideo {
    width: auto !important;
    height: 100% !important;
    object-fit: contain !important;
    background: #000;
    display: block;       /* ƒë·ªÉ margin auto ho·∫°t ƒë·ªông */
    margin: 0 auto;       /* cƒÉn gi·ªØa tr√°i ph·∫£i */
  }

  #popupVideo {
    width: auto !important;
    height: 100% !important;
    object-fit: contain !important;
    background: #000;
    display: block;
    margin: 0 auto;
  }

  #app {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: #000;
  }

}
.giftImage {
  position: absolute;
  height: auto;

  z-index: 80;
  pointer-events: none;

  opacity: 0;
  transform: translateX(-50%) translateY(20px) rotate(14deg);

  transition: opacity 0.4s ease, transform 0.4s ease;
}
  #gift1{
      width: 40%;
  max-width: 340px;
      left: 50%;
      top: 63%;
  }
  #gift2{
      width: 40%;
  max-width: 340px;
      left: 50%;
      top: 63%;
  }
  #gift3{
      width: 40%;
  max-width: 340px;
    left: 50%;
      top: 59%;
  }
  #gift4{
      width: 40%;
  max-width: 340px;
    left: 50%;
      top: 61%;
  }
  #gift5{
      width: 40%;
  max-width: 340px;
    left: 50%;
      top: 57%;
  }
  #gift6{
      width: 40%;
  max-width: 340px;
    left: 50%;
      top: 57%;
  }
  #gift7{
      width: 40%;
  max-width: 500px;
    left: 72%;
      top: 46%;
    transform: translateX(-50%) translateY(5px) rotate(0deg) !important;
  }
</style>
</head>
  
<body>
  
<div id="app">
  <video id="bgVideo"
    src="https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765794137/ipad-boc_tham-01_2_tlcf37.mp4"
    autoplay loop muted playsinline>
  </video>
</div>

<!-- POPUP -->
<div id="popupOverlay">

  <div id="popupBox">
    <div id="closeBtn">‚úï</div>

    <video id="popupVideo"
      muted
      playsinline
      preload="auto">
    </video>
</div>

<script>
  let isClickLocked = false;

  const popupVideos = {
  1: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765944138/FreeMax_gz55cp.mp4",
  2: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-02_1_gew2qs.mp4",
  3: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765944138/GloryAir_vugs8p.mp4",
  4: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765944135/TravelGo_rmpkyr.mp4",
  5: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765944136/Comfy_lyqm1o.mp4",
  6: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765944140/Lumbar_qg70b0.mp4",
  7: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765944136/Voucher_uubv0t.mp4",
};
/* =====================================================
      HOTSPOTS
===================================================== */
const ornamentPositions = [
  { id: 1, x: "50%", y: "13%" },
  { id: 2, x: "50%", y: "29%" },
  { id: 3, x: "62%", y: "43%" },
  { id: 4, x: "37%", y: "51%" },
  { id: 7, x: "70%", y: "62%" },
  { id: 5, x: "27%", y: "68%" },
  { id: 6, x: "47%", y: "70%" },
];

const app = document.getElementById("app");

ornamentPositions.forEach(pos => {
  const dot = document.createElement("div");
  dot.className = "hotspot";
  dot.style.left = pos.x;
  dot.style.top = pos.y;
  dot.onclick = () => {
  // ‚õî n·∫øu ƒëang b·ªã kh√≥a click th√¨ b·ªè qua
  if (isClickLocked) return;

  // üîí kh√≥a click cho iPad n√†y
  isClickLocked = true;

  openPopup(pos.id); // popup hi·ªán ngay

  sendToN8N(pos.id);
  // ‚è≥ ƒë·ª£i 3 gi√¢y r·ªìi m·ªõi g·ª≠i data (tr√°nh spam)
  // setTimeout(() => {
  //   sendToN8N(pos.id);
  // }, 3000);

  // üîì m·ªü kh√≥a sau 3 gi√¢y
  setTimeout(() => {
    isClickLocked = false;
  }, 3000);
};



  app.appendChild(dot);
});

/* =====================================================
      POPUP
===================================================== */
let autoCloseTimeout = null;
  
const popupOverlay = document.getElementById("popupOverlay");
const closeBtn = document.getElementById("closeBtn");
  
closeBtn.onclick = closePopup;

function openPopup(id) {
  if (autoCloseTimeout) {
    clearTimeout(autoCloseTimeout);
    autoCloseTimeout = null;
  }

  const popupVideo = document.getElementById("popupVideo");
  const videoSrc = popupVideos[id];
  if (!popupVideo || !videoSrc) return;

  // Reset video s·∫°ch
  popupVideo.pause();
  popupVideo.removeAttribute("src");
  popupVideo.load();

  // G√°n src m·ªõi
  popupVideo.src = videoSrc;
  popupVideo.currentTime = 0;

  // ‚è≥ Ch·ªù video s·∫µn s√†ng r·ªìi m·ªõi show popup
  popupVideo.oncanplay = () => {
    popupOverlay.style.display = "flex";
    popupVideo.play();
  };

  popupVideo.load();

  autoCloseTimeout = setTimeout(closePopup, 15000);
}

function closePopup() {
  popupOverlay.style.display = "none";

  if (autoCloseTimeout) {
    clearTimeout(autoCloseTimeout);
    autoCloseTimeout = null;
  }

  const popupVideo = document.getElementById("popupVideo");
  popupVideo.pause();
  popupVideo.removeAttribute("src");
  popupVideo.load();
}

function getVideoMetrics() {
  const video = document.getElementById("bgVideo");
  const container = document.getElementById("app");

  const videoRatio = video.videoWidth / video.videoHeight;
  const containerRatio = container.offsetWidth / container.offsetHeight;

  let displayWidth, displayHeight, offsetX, offsetY;

  if (videoRatio > containerRatio) {
    // Video qu√° r·ªông ‚Üí fit theo chi·ªÅu r·ªông container
    displayWidth = container.offsetWidth;
    displayHeight = displayWidth / videoRatio;
    offsetX = 0;
    offsetY = (container.offsetHeight - displayHeight) / 2;
  } else {
    // Video qu√° cao ‚Üí fit theo chi·ªÅu cao container
    displayHeight = container.offsetHeight;
    displayWidth = displayHeight * videoRatio;
    offsetX = (container.offsetWidth - displayWidth) / 2;
    offsetY = 0;
  }

  return { displayWidth, displayHeight, offsetX, offsetY };
}
function updateHotspotPositions() {
  const { displayWidth, displayHeight, offsetX, offsetY } = getVideoMetrics();

  ornamentPositions.forEach((pos, index) => {
    const dot = document.getElementsByClassName("hotspot")[index];

    const x = (parseFloat(pos.x) / 100) * displayWidth + offsetX;
    const y = (parseFloat(pos.y) / 100) * displayHeight + offsetY;

    dot.style.left = x + "px";
    dot.style.top = y + "px";
  });
}
bgVideo.addEventListener("loadedmetadata", updateHotspotPositions);
window.addEventListener("resize", updateHotspotPositions);
document.querySelectorAll(".giftImage").forEach(img => {
  img.style.opacity = "0";
});
  
const giftMap = {
  1: "01 g·ªëi Kymdan PressureFree Air (tr·ªã gi√° 2.678.000 VND)",
  2: "01 g·ªëi Kymdan PressureFree Max (tr·ªã gi√° 3.816.000 VND)",
  3: "01 g·ªëi Kymdan Glory Air (tr·ªã gi√° 2.571.000 VND)",
  4: "01 g·ªëi Kymdan LumbarLatex Travel (tr·ªã gi√° 1.812.000 VND)",
  5: "01 g·ªëi Kymdan TravelGo (tr·ªã gi√° 1.754.000 VND)",
  6: "01 g·ªëi Kymdan Comfy (tr·ªã gi√° 1.826.000 VND)",
  7: "01 b·ªô 2 Voucher (gi·∫£m th√™m 500.000 VND khi mua n·ªám + gi·∫£m th√™m 300.000 VND khi mua g·ªëi)"
};
  
  //n8n
function sendToN8N(giftId) {
  fetch("https://test-christmas-tree-2.app.n8n.cloud/webhook/xmas-tree", {
    method: "POST",
    mode: "no-cors", // ‚úÖ QUAN TR·ªåNG
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      giftId: giftId,
      giftName: giftMap[giftId] || "Qu√† b√≠ m·∫≠t",
      page: "christmas-tree",
      device: getDeviceName(), // ‚úÖ T√äN iPad
      userAgent: navigator.userAgent,
      time: new Date().toISOString()
    })
  });
}
//l·∫•y api thi·∫øt b·ªã 
  function getDeviceName() {
  const params = new URLSearchParams(window.location.search);
  return params.get("device") || "unknown_device";
}


</script>
</body>
</html>
