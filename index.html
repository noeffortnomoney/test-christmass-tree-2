<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Christmas Tree – Version 2</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #000;
  overflow: hidden;
  font-family: sans-serif;
}

/* ================= APP ================= */
#app {
  position: absolute;
  inset: 0;
  width: 100vw;
  height: 100dvh;
  max-width: 1620px;
  max-height: 2160px;
  margin: 0 auto;
  overflow: hidden;
  background: #000;
}

/* ============== BACKGROUND VIDEO ============== */
#bgVideo {
  position: absolute;
  inset: 0;
  width: auto;
  height: 100%;
  object-fit: contain;
  margin: 0 auto;
  display: block;
}

/* ================= HOTSPOT ================= */
.hotspot {
  position: absolute;
  width: 84px;
  height: 84px;
  border-radius: 50%;
  cursor: pointer;
  transform: translate(-50%, -50%);
}

/* ================= POPUP ================= */
#popupOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

#popupBox {
  position: relative;
  width: 100vw;
  height: 100vh;
  max-width: 1620px;
  max-height: 2160px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
}

/* CLOSE */
#closeBtn {
  position: absolute;
  top: 32px;
  right: 32px;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: rgba(0,0,0,0.7);
  border: 3px solid #fff;
  color: #fff;
  font-size: 32px;
  cursor: pointer;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* POPUP VIDEO */
#popupVideo {
  width: auto;
  height: 100%;
  object-fit: contain;
  background: #000;
}

/* ================= MOBILE ================= */
@media (max-width: 768px) {
  #bgVideo,
  #popupVideo {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .hotspot {
    width: 64px;
    height: 64px;
  }

  #closeBtn {
    width: 48px;
    height: 48px;
    font-size: 24px;
    top: 20px;
    right: 20px;
  }
}
</style>
</head>

<body>

<!-- ============== MAIN VIDEO ============== -->
<div id="app">
  <video
    id="bgVideo"
    src="https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765794137/ipad-boc_tham-01_2_tlcf37.mp4"
    autoplay
    loop
    muted
    playsinline>
  </video>
</div>

<!-- ============== POPUP ============== -->
<div id="popupOverlay">
  <div id="popupBox">
    <div id="closeBtn">✕</div>
    <video
      id="popupVideo"
      autoplay
      loop
      muted
      playsinline>
    </video>
  </div>
</div>

<script>
/* ================= VIDEO MAP ================= */
const popupVideos = {
  1: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-02_1_gew2qs.mp4",
  2: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-02_2.mp4",
  3: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-03.mp4",
  4: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-04.mp4",
  5: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-05.mp4",
  6: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-06.mp4",
  7: "https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765936498/ipad-boc_tham-07.mp4",
};

/* ================= HOTSPOTS ================= */
const ornamentPositions = [
  { id: 1, x: "50%", y: "13%" },
  { id: 2, x: "50%", y: "29%" },
  { id: 3, x: "62%", y: "43%" },
  { id: 4, x: "37%", y: "51%" },
  { id: 5, x: "70%", y: "62%" },
  { id: 6, x: "27%", y: "68%" },
  { id: 7, x: "47%", y: "70%" },
];

const app = document.getElementById("app");
const popupOverlay = document.getElementById("popupOverlay");
const popupVideo = document.getElementById("popupVideo");
const closeBtn = document.getElementById("closeBtn");

let autoCloseTimeout = null;

/* ================= CREATE HOTSPOTS ================= */
ornamentPositions.forEach(pos => {
  const dot = document.createElement("div");
  dot.className = "hotspot";
  dot.style.left = pos.x;
  dot.style.top = pos.y;
  dot.onclick = () => openPopup(pos.id);
  app.appendChild(dot);
});

/* ================= POPUP LOGIC ================= */
function openPopup(id) {
  if (autoCloseTimeout) {
    clearTimeout(autoCloseTimeout);
    autoCloseTimeout = null;
  }

  popupOverlay.style.display = "flex";

  const src = popupVideos[id];
  if (src) {
    popupVideo.pause();
    popupVideo.src = src;
    popupVideo.load();
    popupVideo.play();
  }

  autoCloseTimeout = setTimeout(closePopup, 15000);
}

function closePopup() {
  popupOverlay.style.display = "none";

  if (autoCloseTimeout) {
    clearTimeout(autoCloseTimeout);
    autoCloseTimeout = null;
  }

  popupVideo.pause();
  popupVideo.removeAttribute("src");
  popupVideo.load();
}

closeBtn.onclick = closePopup;

/* ================= HOTSPOT POSITION FIX ================= */
function getVideoMetrics() {
  const video = document.getElementById("bgVideo");
  const container = document.getElementById("app");

  const videoRatio = video.videoWidth / video.videoHeight;
  const containerRatio = container.offsetWidth / container.offsetHeight;

  let displayWidth, displayHeight, offsetX, offsetY;

  if (videoRatio > containerRatio) {
    displayWidth = container.offsetWidth;
    displayHeight = displayWidth / videoRatio;
    offsetX = 0;
    offsetY = (container.offsetHeight - displayHeight) / 2;
  } else {
    displayHeight = container.offsetHeight;
    displayWidth = displayHeight * videoRatio;
    offsetX = (container.offsetWidth - displayWidth) / 2;
    offsetY = 0;
  }

  return { displayWidth, displayHeight, offsetX, offsetY };
}

function updateHotspotPositions() {
  const { displayWidth, displayHeight, offsetX, offsetY } = getVideoMetrics();

  ornamentPositions.forEach((pos, index) => {
    const dot = document.getElementsByClassName("hotspot")[index];
    const x = (parseFloat(pos.x) / 100) * displayWidth + offsetX;
    const y = (parseFloat(pos.y) / 100) * displayHeight + offsetY;
    dot.style.left = x + "px";
    dot.style.top = y + "px";
  });
}

bgVideo.addEventListener("loadedmetadata", updateHotspotPositions);
window.addEventListener("resize", updateHotspotPositions);
</script>

</body>
</html>
